---
title: "Milestone 5"
author: "George Dalianis"
date: "3/19/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(tidyverse)
library(janitor)
library(scales)
library(gganimate)
```

```{r, load_data}
social_spending <- read.csv("OECD-data/DP_LIVE_19032020165309966.csv") %>%
  clean_names() %>%
  select(location, time, value) %>%
  filter(! location %in% c("EA", "EU"))
```

```{r, graph_data}
data_social <- as.data.frame(social_spending)
x <- data_social %>%
  group_by(location) %>%
  summarize(avg_spending = mean(value))
y <- ggplot(x, aes(x = reorder(location, avg_spending), y = avg_spending, fill = avg_spending)) + 
  geom_col() + 
  labs(title = "Average Social Benefits to Households in OECD Countries from 1995 to 2018",
       subtitle = "In-cash Benefits, Measured as % of GDP", 
       x = "Country", 
       y = "Average benefits (% of GDP)",
       caption = "Source: OECD National Accounts Statistics") +
  scale_y_continuous(labels = percent_format(scale = 1)) + 
  theme_classic() + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1, vjust = 0.5, size = 9)) + 
  theme(legend.position = "none") + 
  scale_x_discrete(labels = c("MEX" = "Mexico", "KOR" = "Korea", "CHL" = "Chile", "ISR" = "Israel", "ISL" = "Iceland", "AUS" = "Australia", "TUR" = "Turkey", "CAN" = "Canada", "IRL" = "Ireland", "CHE" = "Switzerland", "EST" = "Estonia", "NZL" = "New Zealand", "LVA" = "Latvia", "LTU" = "Lithuania", "NLD" = "Netherlands", "CZE" = "Czech Republic", "JPN" = "Japan", "GBR" = "United Kingdom", "SVK" = "Slovak Republic", "ESP" = "Spain", "HUN" = "Hungary", "NOR" = "Norway", "PRT" = "Portugal", "SWE" = "Sweden", "LUX" = "Luxembourg", "GRC" = "Greece", "POL" = "Poland", "BEL" = "Belgium", "SVN" = "Slovenia", "DNK" = "Denmark", "DEU" = "Germany", "FIN" = "Finland", "ITA" = "Italy", "FRA" = "France", "AUT" = "Austria"))
```

```{r}
oecd_social_benefits.png <- y
ggsave(filename = "oecd_social_benefits.png", device = "png", plot = last_plot())
```


```{r, load_animate}
gdp_per_cap <- read_csv("World_Bank_data/d697f85d-ea2c-4d71-933e-494201e0e9ac_Data.csv") %>%
  clean_names() %>%
  head(-5)
gdp_per_cap0 <- gdp_per_cap[-c(5:9)]
  

pop <- read_csv("World_Bank_data/e254ec52-ffb5-4bb0-9a0b-d8d669a6b94f_Data.csv") %>%
  clean_names() %>%
  head(-5)
pop0 <- pop[-c(5:9)]
```


```{r, tidy_data}
gdp_per_cap1 <- gdp_per_cap0 %>%
  pivot_longer(x1995_yr1995:x2018_yr2018, names_to = "year",
               values_to = "gdp_per_capita",
               names_prefix = "x(.)(.)(.)(.)_yr",
               values_drop_na = TRUE)

pop1 <- pop0 %>%
  pivot_longer(x1995_yr1995:x2018_yr2018, names_to = "year",
               values_to = "population",
               names_prefix = "x(.)(.)(.)(.)_yr",
               values_drop_na = TRUE)

social_spending1 <- social_spending %>%
  rename("country_code" = location,
         "year" = time,
         "pct_soc_spending" = value) 
social_spending1$year <- as.character(social_spending1$year)
graph <- inner_join(gdp_per_cap1, pop1, by = c("country_name", "country_code", "year")) %>%
  select(country_name, country_code, year, gdp_per_capita, population)
graph1 <- inner_join(graph, social_spending1, by = c("country_code", "year"))
```

```{r}
life_expectancy <- read.csv("OECD-data/DP_LIVE_24042020220916159.csv") %>%
  clean_names() %>%
  rename("country_code" = location,
         "year" = time,
         "life_exp" = value) %>%
  select(country_code, year, life_exp)
life_expectancy$year <- as.character(life_expectancy$year)
graph2 <- inner_join(graph1, life_expectancy, by = c("country_code", "year"))
```


